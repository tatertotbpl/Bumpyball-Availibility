<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smashkarts Team Availability</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1 id="team-name">Team Availability</h1>

    <div class="timezone-selector">
        <label for="timezone">Select your timezone:</label>
        <select id="timezone">
            <option value="UTC">UTC</option>
            <option value="America/New_York">EST</option>
            <option value="America/Los_Angeles">PST</option>
            <option value="Europe/London">GMT</option>
            <option value="Europe/Berlin">CET</option>
            <option value="Asia/Tokyo">JST</option>
        </select>
    </div>

    <button id="saveButton">Save Availability</button>

    <table id="availability-grid">
        <thead>
            <tr>
                <th>Time</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
                <th>Sun</th>
            </tr>
        </thead>
        <tbody>
            <!-- JS will populate rows -->
        </tbody>
    </table>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>

    <script>
    // ====== CONFIG ======
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT_ID.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ====== TEAM SETUP ======
    const urlParams = new URLSearchParams(window.location.search);
    const teamId = urlParams.get('team') || "team1"; // default
    document.getElementById("team-name").innerText = `Availability: ${teamId}`;

    const gridBody = document.querySelector('#availability-grid tbody');
    const timezoneSelect = document.getElementById('timezone');
    const saveButton = document.getElementById('saveButton');

    const startHour = 0;
    const endHour = 23;
    let gridData = [];

    // Convert hour to selected timezone
    function convertHour(hour, tz) {
        const date = new Date();
        date.setUTCHours(hour, 0, 0, 0);
        return date.toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit', hour12: false, timeZone: tz});
    }

    // Populate table rows
    function populateGrid(data) {
        gridBody.innerHTML = '';
        const tz = timezoneSelect.value;

        for (let hour = startHour; hour <= endHour; hour++) {
            const row = document.createElement('tr');

            const timeCell = document.createElement('td');
            timeCell.textContent = convertHour(hour, tz);
            row.appendChild(timeCell);

            gridData[hour] = gridData[hour] || [];

            for (let day = 0; day < 7; day++) {
                const cell = document.createElement('td');
                const available = data?.[hour]?.[day] || false;
                cell.classList.add(available ? 'available' : 'unavailable');

                cell.addEventListener('click', () => {
                    cell.classList.toggle('available');
                    cell.classList.toggle('unavailable');
                    gridData[hour][day] = !gridData[hour][day];
                });

                gridData[hour][day] = available;
                row.appendChild(cell);
            }

            gridBody.appendChild(row);
        }
    }

    // ====== LOAD DATA ======
    const teamDoc = db.collection('teams').doc(teamId);
    teamDoc.get().then(doc => {
        if (doc.exists) {
            populateGrid(doc.data().availability);
        } else {
            populateGrid([]);
        }
    });

    // ====== SAVE DATA ======
    saveButton.addEventListener('click', () => {
        teamDoc.set({ availability: gridData })
        .then(() => alert('Availability saved!'))
        .catch(err => console.error(err));
    });

    // ====== TIMEZONE CHANGE ======
    timezoneSelect.addEventListener('change', () => {
        populateGrid(gridData); // refresh times in new TZ
    });
    </script>
</body>
</html>
